# GAS 日報・週報自動送信システム

Google Apps Script (GAS) を使用した映画館上映チケット売上の日報・週報自動送信システムです。

## 概要

このシステムは、Google スプレッドシートに記録されたチケット売上データから、自動で日報と週報を生成し、メールで送信します。金曜日のみ週報PDFを添付し、平日は日報のみを送信することで効率的な運用を実現しています。

## 主な機能

### ✨ 自動処理機能
- **曜日判定による自動切り分け**: 金曜日のみ週報PDF添付、その他は日報のみ
- **シート単位順次処理**: 複数シートを個別に処理してメール送信
- **動的シート選択**: 先頭に「*」が付いたシートを自動選択
- **動的メール設定**: シートごとに異なる宛先・担当者・価格設定

### 📧 メール機能
- **日報メール**: 指定日のチケット売上集計（平日）
- **週報メール**: 日報 + 過去7日間の週報PDF（金曜日のみ）
- **個別宛先**: シートごとに TO/CC 宛先を設定可能

### 🛠️ 管理機能
- **手動実行**: メニューから手動でメール送信
- **テスト機能**: 日報のみ/週報付きの個別テスト
- **エラーハンドリング**: 処理結果の詳細ログ出力

## セットアップ

### 1. スプレッドシート設定

#### シート構成
- シート名の先頭に「*」を付けて対象シートを指定
- 例: `*映画A`, `*映画B`

#### データ形式
| A列（日付） | B列（slot） | C列（Webチケット） | D列（現地チケット） |
|-------------|-------------|-------------------|-------------------|
| 2024/07/05  | 10:00-12:00 | 15               | 8                |
| 2024/07/05  | 14:00-16:00 | 20               | 12               |

#### メール設定セル
各シートの以下のセルに設定値を入力：

| セル | 設定内容 |
|------|----------|
| F6   | TO宛先メールアドレス |
| G6   | 担当者名 |
| G9   | チケット価格（数値） |
| F12-F17 | CC宛先メールアドレス（複数可） |

### 2. GAS設定

#### スクリプト配置
1. Google スプレッドシートで「拡張機能」→「Apps Script」を開く
2. `GAS_jidouka.gs` の内容をコピー＆ペースト
3. 保存して承認

#### トリガー設定
1. Apps Script エディタで「トリガー」を選択
2. 「トリガーを追加」をクリック
3. 以下の設定で作成：
   - **実行する関数**: `triggerDailyReport`
   - **イベントのソース**: 時間主導型
   - **時間ベースのトリガーのタイプ**: 日タイマー
   - **時刻**: お好みの時刻（例：午前9時）

## 使用方法

### 自動実行
設定したトリガーにより、毎日自動で以下の処理が実行されます：

- **平日（月〜木、土〜日）**: 日報のみメール送信
- **金曜日**: 日報 + 週報PDFメール送信

### 手動実行
スプレッドシートのメニュー「日報・週報メール」から：

- **手動で送信（統合）**: 既存の統合処理
- **手動で送信（個別）**: シート別個別処理
- **テスト：日報のみ送信**: 日報のみテスト
- **テスト：日報・週報送信**: 週報付きテスト

## メール内容例

### 日報メール（平日）
```
田中様

お世話になっております。
上映報告botより『映画A』の2024/07/05の日報をお送りします。

【映画A】 日報
・10:00-12:00: 23枚 × 1500円 = 34500円
・14:00-16:00: 32枚 × 1500円 = 48000円

以上、ご確認ください。
```

### 日報・週報メール（金曜日）
```
田中様

お世話になっております。
上映報告botより『映画A』の2024/07/05の日報をお送りします。

【映画A】 日報
・10:00-12:00: 23枚 × 1500円 = 34500円
・14:00-16:00: 32枚 × 1500円 = 48000円

週報を添付させていただきます。

以上、ご確認ください。
```

## 技術仕様

### 主要関数

#### 曜日判定
- `isDayOfWeek(date, dayOfWeek)`: 指定曜日判定
- `isFriday(date)`: 金曜日判定

#### 処理関数
- `processSheetReportDaily()`: 日報のみ処理
- `processSheetReportWithWeekly()`: 日報・週報処理
- `triggerDailyReport()`: トリガー用メイン関数

#### データ処理
- `generateDailyReportForSheet()`: 日報データ生成
- `generateWeeklyReportPDF()`: 週報PDF生成
- `getEmailSettingsForSheet()`: シート別メール設定取得

### エラーハンドリング
- 各シートの処理結果を個別記録
- 詳細なログ出力
- 一部失敗時も他シートの処理を継続

## 更新履歴

### v2.0.0 (2024-07-05)
- **NEW**: 日報・週報切り分け機能
- **NEW**: 曜日判定による自動処理分岐
- **NEW**: テスト用手動実行関数
- **IMPROVE**: ログ表示改善（シート名の「*」除去）
- **IMPROVE**: 週6日分の不要PDF生成を削減

### v1.0.0
- 基本的な日報・週報送信機能
- 動的シート選択機能
- 動的メール設定機能
- シート単位順次処理機能

## トラブルシューティング

### よくある問題

#### メールが送信されない
1. メール設定セル（F6, G6, G9）の入力確認
2. GASの実行権限確認
3. ログでエラー内容確認

#### PDF生成に失敗する
1. シートデータの形式確認
2. 一時シートの削除権限確認
3. Google Drive容量確認

#### トリガーが動作しない
1. トリガー設定の確認
2. `triggerDailyReport` 関数名の確認
3. GASプロジェクトの保存確認

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグ報告や機能改善の提案は、GitHubのIssuesでお願いします。

---

📧 **Contact**: GitHub Issues でお気軽にお問い合わせください  
🤖 **Powered by**: Google Apps Script + Claude Code